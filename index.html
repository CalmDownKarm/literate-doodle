<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AAP Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  {% set base = '.' %}
  {% include template-navbar.html %}
  <!-- TODO: Filter bars -->
  <div class="container-fluid">
    {%include banner.html %}
    <div class="nav nav-row py-1">
      <div class="h3 col-md-4 text-center mx-auto" id="outcomeTab">Explore by Outcome</div>
      <div class="h3 col-md-4 text-center mx-auto" id="departmentTab">Explore by Department</div>
    </div>

    <div class="d-flex flex-wrap justify-content-center">
      <template>
        <% outcomes.forEach(function(outcome){ %>
        <div class="card col-md-3 px-0">
          <img class="card-img-top img-fluid" src="<%= outcome.img %>">
          <div class="card-body">
            <h5 class="card-title"><%= outcome.Outcome? outcome.Outcome : outcome.Department %></h5>
            <a href="promises?Outcome=<%= outcome.Outcome %>"><p class="card-text"><%= outcome['Outcome|count']? outcome['Outcome|count'] : outcome['Department|count'] %> Promises</p></a>
            <a href="updates?Outcome=<%= outcome.Outcome %>"><p class="card-text"><%= outcome['Outcome|count']? outcome['Outcome|count'] : outcome['Department|count'] %> Updates</p></a>
          </div>
        </div>
        <% }) %>
      </template>
    </div>
  </div> <!-- .container-fluid -->

  <script src="ui/jquery/dist/jquery.min.js"></script>
  <script src="ui/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="ui/lodash/lodash.min.js"></script>
  <script src="ui/g1/dist/g1.min.js"></script>
  <script>
    $(function () {
      $.when(
        $.get('data/outcomes?_sort=Outcome'),
        $.get('data/promises?_by=Outcome&_c=Outcome|count')
        // $.get('data/updates')
      ).done(function (outcomes, promises) {
        output = _.merge(outcomes, promises)
        console.log(output)
        $('body').template({outcomes:output[0]})
      })

    })

    $('#outcomeTab').click(function(){
      $.when(
        $.get('data/outcomes?_sort=Outcome'),
        $.get('data/promises?_by=Outcome&_c=Outcome|count')
        // $.get('data/updates')
      ).done(function (outcomes, promises) {
        output = _.merge(outcomes, promises)
        console.log(output)
        $('body').template({outcomes:output[0]})
      })
    });

    $('#departmentTab').click(function(){
      $.when(
        $.get('data/department?_sort=Department'),
        $.get('data/promises?_by=Department&_c=Department|count')
        // $.get('data/updates')
      ).done(function (outcomes, promises) {
        output = _.merge(outcomes, promises)
        console.log(output)
        $('body').template({outcomes:output[0]})
      })
    });

  </script>
  <!-- Commonly used libraries:
  <script src="ui/d3v5/dist/d3.min.js"></script>
  <script src="ui/morphdom/dist/morphdom-umd.min.js"></script>
  <script src="ui/moment/min/moment-with-locales.min.js"></script>
  <script src="ui/daterangepicker/daterangepicker.js"></script>
  <script src="ui/leaflet/dist/leaflet.js"></script>
  <script src="ui/topojson/dist/topojson.min.js"></script>
  -->
</body>

</html>
